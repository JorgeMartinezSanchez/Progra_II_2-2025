<!-- chat.component.html -->
<div class="chat-component">
    @if(currentChat) {
        <!-- Header del chat -->
        <div class="chat-header">
            <button class="back-button" (click)="goBack()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="chat-avatar">
                @if(currentChat.contactBase64Pfp) {
                    <img [src]="currentChat.contactBase64Pfp" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                } @else {
                    {{ currentChat.contactUsername?.charAt(0)?.toUpperCase() }}
                }
            </div>
            <div class="chat-info">
                <h2 class="chat-title">{{ currentChat.contactUsername }}</h2>
                <p class="chat-status">
                    <i class="fas fa-lock"></i> Chat encriptado
                    â€¢ <i class="fas fa-user"></i> Chat privado
                </p>
            </div>
        </div>

        <!-- Ãrea de mensajes -->
        <div class="messages-container">
            @if(loadingMessages) {
                <div class="empty-messages">
                    <p>Cargando mensajes...</p>
                </div>
            } @else {
                @for(message of messages; track message.messageId) {
                    <div class="message" [class.own-message]="isOwnMessage(message)">
                        
                        <!-- Mostrar nombre del remitente si no es propio -->
                        @if(!isOwnMessage(message)) {
                            <div class="sender-name">
                                {{ getSenderName(message) }}
                            </div>
                        }
                        
                        <div class="message-content">
                            <p>{{ message.content || 'ðŸ”’ Mensaje cifrado' }}</p>
                            <span class="message-time">
                                {{ formatMessageTime(message.timeStamp) }}
                            </span>
                        </div>
                    </div>
                } @empty {
                    <div class="empty-messages">
                        <p>No hay mensajes aÃºn. Â¡EnvÃ­a el primero!</p>
                    </div>
                }
            }
        </div>

        <!-- Input para enviar mensajes -->
        <div class="message-input-container">
            <input 
                #messageInput
                type="text" 
                placeholder="Escribe un mensaje..." 
                class="message-input"
                (keyup.enter)="sendMessage(messageInput.value); messageInput.value = ''">
            <button class="send-button" (click)="sendMessage(messageInput.value); messageInput.value = ''">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    } @else {
        <!-- Estado cuando no hay chat seleccionado -->
        <div class="no-chat-selected">
            <i class="fas fa-comments"></i>
            <h3>Selecciona un chat</h3>
            <p>Elige una conversaciÃ³n de la lista para empezar a chatear</p>
        </div>
    }
</div>