<!-- home.component.html -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div class="home-container">
    <div class="main-container">
        <!-- Header del usuario -->
        <div class="account-settings">
            @if(!profilePicture){
                <i class="fas fa-user-circle profile-icon" (click)="move('/user-config')"></i>
            } @else {
                <img src="ruta/a/tu/foto.jpg" alt="Foto de perfil" class="profile-image">
            }
            <h2>{{ userMap[1] }}</h2> <!-- Muestra "Jaime" -->
        </div>

        <!-- Botón añadir contacto -->
        @if(chats.length != 0){
            <i class="fas fa-plus add-icon" title="Add new contact" (click)="move('/add-contact')"></i>
        }

        <!-- Para el widget vacío -->
        @if(chats.length == 0){
            <div class="empty-chat-widget" (click)="move('/add-contact')">
                <i class="fas fa-plus add-icon-bigger"></i>
                <p>Your chat is empty, click to add a new secure contact</p>
            </div>
        } @else {
            <div class="chat-list">
                @for(chat of chats; track chat.chatId){
                    <div class="chat-widget" (click)="selectChat(chat)">
                        <div class="chat-avatar">
                            {{ chat.name.charAt(0).toUpperCase() }}
                        </div>
                        <div class="chat-info">
                            <h3 class="chat-name">{{ chat.name }}</h3>
                            <p class="chat-preview">
                                @if(chat.isEncrypted){
                                    <i class="fas fa-lock encrypted-icon"></i>
                                }
                                <!-- Muestra el nombre del último mensaje si es grupo -->
                                @if(chat.type === 'group' && chat.lastMessage && chat.messages.length > 0){
                                    @let lastMessage = chat.messages[chat.messages.length - 1];
                                    {{ getUserName(lastMessage.userId) }}: {{ chat.lastMessage }}
                                } @else if (chat.type === 'group' && chat.lastMessage) {
                                    {{ chat.lastMessage }}
                                } @else {
                                    {{ chat.lastMessage || 'No messages yet' }}
                                }
                            </p>
                        </div>
                    </div>
                }
            </div>
        }
    </div>

    <div class="chat-container">
        <!-- Pasa el chat seleccionado Y el userMap al componente chat -->
        <app-chat [usuario]="selectedChat" [userMap]="userMap"></app-chat>
    </div>
</div>